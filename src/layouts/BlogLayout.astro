---
import BaseLayout from './BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const recentPosts = posts.slice(0, 10);
---

<BaseLayout title="Blog">
  <div class="row t30 b20">
    <div class="small-12 columns">
      <h1>Blog</h1>
      
      <div class="blog-posts">
        {recentPosts.map((post) => (
          <article class="blog-post">
            <header>
              <h2>
                <a href={`/blog/${post.slug}/`}>{post.data.title}</a>
              </h2>
              <p class="subheadline">
                <time datetime={post.data.date.toISOString()}>
                  {post.data.date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                  })}
                </time>
                {post.data.categories && ` â€¢ ${post.data.categories}`}
              </p>
            </header>
            
            {post.data.teaser && (
              <p class="teaser">{post.data.teaser}</p>
            )}
            
            <a href={`/blog/${post.slug}/`} class="button tiny radius">Read More</a>
          </article>
        ))}
      </div>
    </div>
  </div>
</BaseLayout>
